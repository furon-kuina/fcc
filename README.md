# fcc

### 2023/07/16
書き始めた。以前にも少しだけやったことがあるので序盤はスムーズに進む。

乗算を実装するところで詰まった。なぜか16*16が0になる。どうも結果が8ビットで表されているっぽい。
レジスタって基本64ビットじゃないの？
アセンブリは以下:
```
push 16
push 16
pop rdi
pop rax
imul rax, rdi
push rax
pop rax
ret
```

これはUNIXの終了コードが0-255の値しか取れないことが原因だった（よく見るとテキストに書いてある）。

### 2023/07/22
ファイルを分割するところで詰まっている。これまで1つのグローバル変数に持てたトークン列やASTを
どう処理するかが面倒。とりあえず雑に分割したらなぜかパースがうまくいかない。

具体的な問題は、`consume`や`expect`に`*Token`を渡すだけでは、それを進めてはくれないということ。
これまではグローバル変数を使っていたから問題なかったが、ファイルを分割するとそうはいかない。
結局、[chibiccのコミット](https://github.com/rui314/chibicc/commit/725badfb494544b7c7f1d4c4690b9bc033c6d051#diff-a0cb465674c1b01a07d361f25a0ef2b0214b7dfe9412b7777f89add956da10ec)を参考に、`**Token`を渡して進めてもらうようにした。

よくよく考えると、`*Token`型の変数はそのトークンの情報と、次のトークンへのポインタしか持っておらず、「いまどこを見てるか」という情報は入ってない。その情報を与えるために`**Token`を渡す必要があるんだな。

### 2023/07/23
ここまで実装して思ったが、`parse.c`でだけ使うグローバル変数`token`を導入して、
`parse()`の引数として渡したトークン列を`token`に代入してしまったほうが簡単。
そっちで行くことにした。chibiccのコードと乖離が生じるのは少し怖いが、考える機会になるだろう。
これでようやく先に進める。

### 2023/07/25
ローカル変数まで実装できた。
ちょっとスタックの動きが理解しきれてない部分がある。

### 2023/07/26
ローカル変数の再代入がうまくいかない。
そろそろデバッグ用のツールを整備したほうがいい気がしてきた。
欲しいのは
* トークナイズ結果の可視化（これは現状のprintで十分かも）
* パース結果のASTの可視化（これはどうやって作るのがいいんだろう）
